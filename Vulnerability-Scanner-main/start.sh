#!/bin/bash

# Check if virtual environment exists, if not create one
if [ ! -d "venv" ]; then
    echo "Creating virtual environment..."
    python3 -m venv venv
fi

# Activate the virtual environment
source venv/bin/activate

# Install dependencies
echo "Installing dependencies..."
pip install -r requirements.txt

# Check for necessary tools
echo "Checking for required security tools..."

# Check for SQLMap
if ! command -v sqlmap &> /dev/null; then
    echo "SQLMap not found. Installing..."
    pip install sqlmap
fi

# Check for OWASP ZAP
if ! command -v zap-cli &> /dev/null; then
    echo "OWASP ZAP CLI not found. Please install OWASP ZAP manually."
    echo "Visit: https://www.zaproxy.org/download/"
fi

# Check for Nikto
if ! command -v nikto &> /dev/null; then
    echo "Nikto not found. Please install Nikto manually."
    echo "For Linux: sudo apt-get install nikto"
    echo "For Mac: brew install nikto"
fi

# Note about Nessus
echo "Note: Nessus requires separate installation and licensing."
echo "Please ensure Nessus is properly installed and configured."
echo "Visit: https://www.tenable.com/products/nessus"

# Initialize database if it doesn't exist
if [ ! -f "db/scans.db" ]; then
    echo "Initializing database..."
    python -c "from scanner.scanner import init_db; init_db()"
fi

# Start the web application
echo "Starting Vulnerability Scanner..."
python app.py